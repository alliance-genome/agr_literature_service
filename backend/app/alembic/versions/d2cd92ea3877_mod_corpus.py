"""mod_corpus

Revision ID: d2cd92ea3877
Revises: 226a02bfa5b3
Create Date: 2022-04-22 10:27:58.093689

"""
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = 'd2cd92ea3877'
down_revision = '226a02bfa5b3'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        'mod',
        sa.Column('mod_id', sa.Integer(), autoincrement=True, nullable=False),
        sa.Column('abbreviation', sa.String(length=10), nullable=False),
        sa.Column('short_name', sa.String(length=10), nullable=False),
        sa.Column('full_name', sa.String(length=100), nullable=False),
        sa.Column('date_updated', sa.DateTime(), nullable=True),
        sa.Column('date_created', sa.DateTime(), nullable=False),
        sa.PrimaryKeyConstraint('mod_id'),
        sa.UniqueConstraint('abbreviation'),
        sa.UniqueConstraint('full_name'),
        sa.UniqueConstraint('short_name')
    )
    op.create_table(
        'mod_corpus_association_version',
        sa.Column('mod_corpus_association_id', sa.Integer(), autoincrement=False, nullable=False),
        sa.Column('reference_id', sa.Integer(), autoincrement=False, nullable=True),
        sa.Column('mod_id', sa.Integer(), autoincrement=False, nullable=True),
        sa.Column('corpus', sa.Boolean(), autoincrement=False, nullable=True),
        sa.Column('mod_corpus_sort_source', sa.Enum('Mod_pubmed_search', 'Dqm_files', 'Manual_creation', 'Assigned_for_review', name='modcorpussortsourcetype'), autoincrement=False, nullable=True),
        sa.Column('date_updated', sa.DateTime(), autoincrement=False, nullable=True),
        sa.Column('date_created', sa.DateTime(), autoincrement=False, nullable=True),
        sa.Column('transaction_id', sa.BigInteger(), autoincrement=False, nullable=False),
        sa.Column('end_transaction_id', sa.BigInteger(), nullable=True),
        sa.Column('operation_type', sa.SmallInteger(), nullable=False),
        sa.Column('reference_id_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('mod_id_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('corpus_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('mod_corpus_sort_source_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('date_updated_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('date_created_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.PrimaryKeyConstraint('mod_corpus_association_id', 'transaction_id')
    )
    op.create_index(op.f('ix_mod_corpus_association_version_end_transaction_id'), 'mod_corpus_association_version', ['end_transaction_id'], unique=False)
    op.create_index(op.f('ix_mod_corpus_association_version_mod_id'), 'mod_corpus_association_version', ['mod_id'], unique=False)
    op.create_index(op.f('ix_mod_corpus_association_version_operation_type'), 'mod_corpus_association_version', ['operation_type'], unique=False)
    op.create_index(op.f('ix_mod_corpus_association_version_reference_id'), 'mod_corpus_association_version', ['reference_id'], unique=False)
    op.create_index(op.f('ix_mod_corpus_association_version_transaction_id'), 'mod_corpus_association_version', ['transaction_id'], unique=False)
    op.create_table(
        'mod_version',
        sa.Column('mod_id', sa.Integer(), autoincrement=False, nullable=False),
        sa.Column('abbreviation', sa.String(length=10), autoincrement=False, nullable=True),
        sa.Column('short_name', sa.String(length=10), autoincrement=False, nullable=True),
        sa.Column('full_name', sa.String(length=100), autoincrement=False, nullable=True),
        sa.Column('date_updated', sa.DateTime(), autoincrement=False, nullable=True),
        sa.Column('date_created', sa.DateTime(), autoincrement=False, nullable=True),
        sa.Column('transaction_id', sa.BigInteger(), autoincrement=False, nullable=False),
        sa.Column('end_transaction_id', sa.BigInteger(), nullable=True),
        sa.Column('operation_type', sa.SmallInteger(), nullable=False),
        sa.Column('abbreviation_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('short_name_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('full_name_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('date_updated_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.Column('date_created_mod', sa.Boolean(), server_default=sa.text('false'), nullable=False),
        sa.PrimaryKeyConstraint('mod_id', 'transaction_id')
    )
    op.create_index(op.f('ix_mod_version_end_transaction_id'), 'mod_version', ['end_transaction_id'], unique=False)
    op.create_index(op.f('ix_mod_version_operation_type'), 'mod_version', ['operation_type'], unique=False)
    op.create_index(op.f('ix_mod_version_transaction_id'), 'mod_version', ['transaction_id'], unique=False)
    op.create_table(
        'mod_corpus_association',
        sa.Column('mod_corpus_association_id', sa.Integer(), autoincrement=True, nullable=False),
        sa.Column('reference_id', sa.Integer(), nullable=True),
        sa.Column('mod_id', sa.Integer(), nullable=True),
        sa.Column('corpus', sa.Boolean(), nullable=True),
        sa.Column('mod_corpus_sort_source', sa.Enum('Mod_pubmed_search', 'Dqm_files', 'Manual_creation', 'Assigned_for_review', name='modcorpussortsourcetype'), nullable=False),
        sa.Column('date_updated', sa.DateTime(), nullable=True),
        sa.Column('date_created', sa.DateTime(), nullable=False),
        sa.ForeignKeyConstraint(['mod_id'], ['mod.mod_id'], ondelete='CASCADE'),
        sa.ForeignKeyConstraint(['reference_id'], ['references.reference_id'], ondelete='CASCADE'),
        sa.PrimaryKeyConstraint('mod_corpus_association_id'),
        sa.UniqueConstraint('reference_id', 'mod_id', name='_mod_corpus_association_unique')
    )
    op.create_index(op.f('ix_mod_corpus_association_mod_id'), 'mod_corpus_association', ['mod_id'], unique=False)
    op.create_index(op.f('ix_mod_corpus_association_reference_id'), 'mod_corpus_association', ['reference_id'], unique=False)
    op.drop_column('references', 'date_published_in_pubmed')
    op.drop_column('references_version', 'date_published_in_pubmed_mod')
    op.drop_column('references_version', 'date_published_in_pubmed')
    op.add_column('transaction', sa.Column('user_id', sa.String(), nullable=True))
    op.create_index(op.f('ix_transaction_user_id'), 'transaction', ['user_id'], unique=False)
    op.create_foreign_key(None, 'transaction', 'users', ['user_id'], ['id'])
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'transaction', type_='foreignkey')
    op.drop_index(op.f('ix_transaction_user_id'), table_name='transaction')
    op.drop_column('transaction', 'user_id')
    op.add_column('references_version', sa.Column('date_published_in_pubmed', sa.VARCHAR(), autoincrement=False, nullable=True))
    op.add_column('references_version', sa.Column('date_published_in_pubmed_mod', sa.BOOLEAN(), server_default=sa.text('false'), autoincrement=False, nullable=False))
    op.add_column('references', sa.Column('date_published_in_pubmed', sa.VARCHAR(), autoincrement=False, nullable=True))
    op.drop_index(op.f('ix_mod_corpus_association_reference_id'), table_name='mod_corpus_association')
    op.drop_index(op.f('ix_mod_corpus_association_mod_id'), table_name='mod_corpus_association')
    op.drop_table('mod_corpus_association')
    op.drop_index(op.f('ix_mod_version_transaction_id'), table_name='mod_version')
    op.drop_index(op.f('ix_mod_version_operation_type'), table_name='mod_version')
    op.drop_index(op.f('ix_mod_version_end_transaction_id'), table_name='mod_version')
    op.drop_table('mod_version')
    op.drop_index(op.f('ix_mod_corpus_association_version_transaction_id'), table_name='mod_corpus_association_version')
    op.drop_index(op.f('ix_mod_corpus_association_version_reference_id'), table_name='mod_corpus_association_version')
    op.drop_index(op.f('ix_mod_corpus_association_version_operation_type'), table_name='mod_corpus_association_version')
    op.drop_index(op.f('ix_mod_corpus_association_version_mod_id'), table_name='mod_corpus_association_version')
    op.drop_index(op.f('ix_mod_corpus_association_version_end_transaction_id'), table_name='mod_corpus_association_version')
    op.drop_table('mod_corpus_association_version')
    op.drop_table('mod')
    # ### end Alembic commands ###
